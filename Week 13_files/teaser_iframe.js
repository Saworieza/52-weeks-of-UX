/*! scripts/tumblr.js */
(typeof Tumblr!=="undefined")||(Tumblr={});
/*! scripts/tumblr/post_message_listener.js */
Tumblr.PostMessageListener=(function(){return{initialize:function(d){d=d||function(){};var c=window.addEventListener?"addEventListener":"attachEvent";var b=window[c];var a=c=="attachEvent"?"onmessage":"message";b(a,function(g){var f=g.data.split(";");d(f,g.origin)},false)}}})();
/*! scripts/tumblr/teaser_iframe.js */
(function(d,c){var g=function(l,k){if(!l){l=document.location.href}var m=l.replace(/^[^\/]+\/\/([^\/]+).*/i,"$1");var o=m.split(".");if(o.length<2){return m}var n=o.slice(k?1:-2).join(".");if(n.toLowerCase()==="tumblr.net"){return m}return n};var f=function(){var k={};window.location.hash.replace(/[#?&]+([^=&]+)(=[^&]*)?/gi,function(l,n,o){k[n]=(o===undefined)?true:o.substring(1);if(k[n].indexOf("/")!==-1){k[n]=encodeURIComponent(k[n])}});window.location.search.replace(/[?&]+([^=&]+)(=[^&]*)?/gi,function(l,n,o){k[n]=(o===undefined)?true:o.substring(1)});return k};var i=function(m,k,l){if(!l){l=parent}if(typeof m!=="string"){m=m.join(";")}if(l!==window){l.postMessage(m,k)}};var b=g();var h="http://"+(b.toLowerCase()!=="tumblr.com"?b:"www.tumblr.com");var a=f();var j=decodeURIComponent(a.src);var e={initialize:function(){this.jqXHR=false;this.posts=[];this.current_post=false;this.cache_selectors();d(document.body).addClass("inactive");this.$get_started.attr("href",h+"/register/get_started?referring_blog="+decodeURIComponent(a.name));Tumblr.PostMessageListener.initialize(_.bind(this.post_message_event,this));this.bind_events();if(window.parent!==window){this.hide()}else{this.show()}},cache_selectors:function(){this.$fullscreen_post_bg=d("#fullscreen_post_bg");this.$fullscreen_post_image=d("#fullscreen_post_image");this.$by_tumblelog=d("#by_tumblelog");this.$by_avatar_link=d("#by_avatar_link");this.$by_avatar=d("#by_avatar");this.$get_started=d("#get_started")},bind_events:function(){this.$fullscreen_post_image.on("load",function(){d(document.body).removeClass("loading")});d(document).on("mouseleave",function(k){i(["teaser_iframe","close",(document.location.protocol+"//"+document.location.host)],decodeURIComponent(j),window.parent)})},unbind_events:function(){this.$fullscreen_post_image.off("load");d(document).off("mouseleave")},post_message_event:function(l,k){if(l[0]!=="teaser"||l.length<2){return}switch(l[1]){case"refresh":this.prepare_next_post();return;case"show":this.show();return;case"hide":this.hide();return}},prepare_next_post:function(){if(!this.posts.length){return this.load_posts(true)}this.current_post=this.posts.shift();this.set_post(this.current_post);if(!this.posts.length){return this.load_posts(false)}},load_posts:function(k){if(this.jqXHR){return}this.jqXHR=d.ajax({type:"get",url:h+"/svc/teaser",success:_.bind(function(l){if(!l.length){if(console&&console.log){console.log("No posts returned!")}return}this.posts=l;if(k){this.prepare_next_post()}},this),complete:_.bind(function(l){this.jqXHR=false},this)})},set_post:function(k){d(document.body).addClass("loading");this.$by_tumblelog.attr("href",k.tumblelog.url).text(k.tumblelog.name);this.$by_avatar_link.attr("href",k.tumblelog.url).css("background-image","url('"+k.tumblelog.avatar+"')");this.$by_avatar.attr({src:k.tumblelog.avatar,alt:k.tumblelog.name});this.$fullscreen_post_bg.css("background-image","url('"+k.post.media_url+"')");this.$fullscreen_post_image.attr("src",k.post.media_url).each(function(){if(this.complete||this.naturalWidth||this.naturalHeight){d(this).load()}})},show:function(){if(!this.posts.length){this.load_posts(true)}d(document.body).removeClass("inactive waiting")},hide:function(){d(document.body).addClass("waiting")}};c.TeaserIframe=e})(jQuery,Tumblr);